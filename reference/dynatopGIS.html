<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>R6 Class for processing a catchment to make a Dynamic TOPMODEL — dynatopGIS • dynatopGIS</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="R6 Class for processing a catchment to make a Dynamic TOPMODEL — dynatopGIS"><meta property="og:description" content="This package contains the code for setting up a dynamic TOPMODEL implementation"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatopGIS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/dynatopGIS.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Banding.html">Distance Classification</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/waternumbers/dynatopGIS/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>R6 Class for processing a catchment to make a Dynamic TOPMODEL</h1>
    <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatopGIS/blob/HEAD/R/dygis.R" class="external-link"><code>R/dygis.R</code></a>, <a href="https://github.com/waternumbers/dynatopGIS/blob/HEAD/R/dynatopGIS-package.R" class="external-link"><code>R/dynatopGIS-package.R</code></a></small>
    <div class="hidden name"><code>dynatopGIS.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This package contains the code for setting up a dynamic TOPMODEL implementation</p>
    </div>


    <div id="methods">
    <h2>Methods</h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-dynatopGIS-new"><code>dynatopGIS$new()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-add_dem"><code>dynatopGIS$add_dem()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-add_channel"><code>dynatopGIS$add_channel()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-add_layer"><code>dynatopGIS$add_layer()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-get_layer"><code>dynatopGIS$get_layer()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-plot_layer"><code>dynatopGIS$plot_layer()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-sink_fill"><code>dynatopGIS$sink_fill()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-compute_properties"><code>dynatopGIS$compute_properties()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-compute_flow_lengths"><code>dynatopGIS$compute_flow_lengths()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-classify"><code>dynatopGIS$classify()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-combine_classes"><code>dynatopGIS$combine_classes()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-create_model"><code>dynatopGIS$create_model()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-get_version"><code>dynatopGIS$get_version()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-get_method"><code>dynatopGIS$get_method()</code></a></p></li>
<li><p><a href="#method-dynatopGIS-clone"><code>dynatopGIS$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-dynatopGIS-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Initialise a project, or reopen an existing project</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/dynatopGIS.html">dynatopGIS</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">projectFolder</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>projectFolder</code></dt>
<dd><p>folder for data files</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h4>
<p>This loads the project data files found at <code>projFile</code> if present. If not the value is stored for later use. The project data files are given by <code>projfile,&lt;tif,shp&gt;</code></p>
</div>

<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A new `dynatopGIS` object</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-add_dem"></a><div class="section">
<h3 id="method-add-dem-">Method <code>add_dem()</code><a class="anchor" aria-label="anchor" href="#method-add-dem-"></a></h3>
<p>Import a dem to the `dynatopGIS` object</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">add_dem</span><span class="op">(</span><span class="va">dem</span>, fill_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>dem</code></dt>
<dd><p>a <code>raster</code> layer object or the path to file containing one which is the DEM</p></dd>


<dt><code>fill_na</code></dt>
<dd><p>should NA values in dem be filled. See details</p></dd>


<dt><code>verbose</code></dt>
<dd><p>Should additional progress information be printed</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-1">Details<a class="anchor" aria-label="anchor" href="#details-1"></a></h4>
<p>If not a <code>raster</code> the DEM is read in using the terra package. If <code>fill_na</code> is <code>TRUE</code> all NA values other then those that link to the edge of the dem are filled so they can be identified as sinks.</p>
</div>

<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>suitable for chaining</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-add_channel"></a><div class="section">
<h3 id="method-add-channel-">Method <code>add_channel()</code><a class="anchor" aria-label="anchor" href="#method-add-channel-"></a></h3>
<p>Import channel data to the `dynatopGIS` object</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">add_channel</span><span class="op">(</span><span class="va">channel</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>channel</code></dt>
<dd><p>a SpatialLinesDataFrame, SpatialPolygonsDataFrame or file path containing the channel information</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-2">Details<a class="anchor" aria-label="anchor" href="#details-2"></a></h4>
<p>Takes the representation of the channel network as a SpatialPolygonsDataFrame with properties name, length, area, startNode, endNode and overlaying it on the DEM. In doing this a variable called id is created (or overwritten) other variables in the data frame are passed through unaltered.</p>
</div>

<div class="section">
<h4 id="returns-2">Returns<a class="anchor" aria-label="anchor" href="#returns-2"></a></h4>
<p>suitable for chaining</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-add_layer"></a><div class="section">
<h3 id="method-add-layer-">Method <code>add_layer()</code><a class="anchor" aria-label="anchor" href="#method-add-layer-"></a></h3>
<p>Add a layer of geographical information</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">add_layer</span><span class="op">(</span><span class="va">layer</span>, layer_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">layer</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>layer</code></dt>
<dd><p>the raster layer to add (see details)</p></dd>


<dt><code>layer_name</code></dt>
<dd><p>name to give to the layer</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-3">Details<a class="anchor" aria-label="anchor" href="#details-3"></a></h4>
<p>The layer should either be a raster layer or a file that can be read by the <code>raster</code> package. The projection, resolution and extent are checked against the existing project data. Only layer names not already in use (or reserved) are allowed. If successful the layer is added to the project tif file.</p>
</div>

<div class="section">
<h4 id="returns-3">Returns<a class="anchor" aria-label="anchor" href="#returns-3"></a></h4>
<p>suitable for chaining</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-get_layer"></a><div class="section">
<h3 id="method-get-layer-">Method <code>get_layer()</code><a class="anchor" aria-label="anchor" href="#method-get-layer-"></a></h3>
<p>Get a layer of geographical information or a list of layer names</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">get_layer</span><span class="op">(</span>layer_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>layer_name</code></dt>
<dd><p>name of the layer give to the layer</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-4">Returns<a class="anchor" aria-label="anchor" href="#returns-4"></a></h4>
<p>a `raster` layer of the requested information if layer_name is given else a vector of layer names</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-plot_layer"></a><div class="section">
<h3 id="method-plot-layer-">Method <code>plot_layer()</code><a class="anchor" aria-label="anchor" href="#method-plot-layer-"></a></h3>
<p>Plot a layer</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">plot_layer</span><span class="op">(</span><span class="va">layer_name</span>, add_channel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>layer_name</code></dt>
<dd><p>the name of layer to plot</p></dd>


<dt><code>add_channel</code></dt>
<dd><p>should the channel be added to the plot</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-5">Returns<a class="anchor" aria-label="anchor" href="#returns-5"></a></h4>
<p>a plot</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-sink_fill"></a><div class="section">
<h3 id="method-sink-fill-">Method <code>sink_fill()</code><a class="anchor" aria-label="anchor" href="#method-sink-fill-"></a></h3>
<p>The sink filling algorithm of Planchona and Darboux (2001)</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">sink_fill</span><span class="op">(</span></span>
<span>  min_grad <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  max_it <span class="op">=</span> <span class="fl">1e+06</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hot_start <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>min_grad</code></dt>
<dd><p>Minimum gradient between cell centres</p></dd>


<dt><code>max_it</code></dt>
<dd><p>maximum number of replacement cycles</p></dd>


<dt><code>verbose</code></dt>
<dd><p>print out additional diagnostic information</p></dd>


<dt><code>hot_start</code></dt>
<dd><p>start from filled_dem if it exists</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-4">Details<a class="anchor" aria-label="anchor" href="#details-4"></a></h4>
<p>The algorithm implemented is that described in Planchona and Darboux, "A fast, simple and versatile algorithm to fill the depressions in digital elevation models" Catena 46 (2001). A pdf can be found at (&lt;https://horizon.documentation.ird.fr/exl-doc/pleins_textes/pleins_textes_7/sous_copyright/010031925.pdf&gt;).</p>
</div>


</div><p></p><hr><a id="method-dynatopGIS-compute_properties"></a><div class="section">
<h3 id="method-compute-properties-">Method <code>compute_properties()</code><a class="anchor" aria-label="anchor" href="#method-compute-properties-"></a></h3>
<p>Computes statistics e.g. gradient, log(upslope area / gradient) for raster cells</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">compute_properties</span><span class="op">(</span>min_grad <span class="op">=</span> <span class="fl">1e-04</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>min_grad</code></dt>
<dd><p>gradient that can be assigned to a pixel if it can't be computed</p></dd>


<dt><code>verbose</code></dt>
<dd><p>print out additional diagnostic information</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-5">Details<a class="anchor" aria-label="anchor" href="#details-5"></a></h4>
<p>The algorithm passed through the cells in decreasing height. Min grad is applied to all cells. It is also used for missing gradients in pixels which are partially channel but have no upslope neighbours.</p>
</div>


</div><p></p><hr><a id="method-dynatopGIS-compute_flow_lengths"></a><div class="section">
<h3 id="method-compute-flow-lengths-">Method <code>compute_flow_lengths()</code><a class="anchor" aria-label="anchor" href="#method-compute-flow-lengths-"></a></h3>
<p>Computes flow length for each pixel to the channel</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">compute_flow_lengths</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-8">Arguments<a class="anchor" aria-label="anchor" href="#arguments-8"></a></h4>
<p></p><div class="arguments"><dl><dt><code>verbose</code></dt>
<dd><p>print out additional diagnostic information</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-6">Details<a class="anchor" aria-label="anchor" href="#details-6"></a></h4>
<p>The algorithm passed through the cells in increasing height. For measures of flow length to the channel are computed. The shortest length (minimum length to channel through any flow path), the dominant length (the length taking the flow direction with the highest fraction for each pixel on the path) and expected flow length (flow length based on sum of downslope flow lengths based on fraction of flow to each cell) and band (strict sequence to ensure that all contributing cell have a higher band value). By definition cells in the channel that have no land area have a length (or band) of NA.</p>
</div>


</div><p></p><hr><a id="method-dynatopGIS-classify"></a><div class="section">
<h3 id="method-classify-">Method <code>classify()</code><a class="anchor" aria-label="anchor" href="#method-classify-"></a></h3>
<p>Create a catchment classification based cutting an existing layer into classes</p><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">classify</span><span class="op">(</span><span class="va">layer_name</span>, <span class="va">base_layer</span>, <span class="va">cuts</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-9">Arguments<a class="anchor" aria-label="anchor" href="#arguments-9"></a></h4>
<p></p><div class="arguments"><dl><dt><code>layer_name</code></dt>
<dd><p>name of the new layer to create</p></dd>


<dt><code>base_layer</code></dt>
<dd><p>name of the layer to be cut into classes</p></dd>


<dt><code>cuts</code></dt>
<dd><p>values on which to cut into classes. These should be numeric and define either the number of bands (single value) or breaks between band (multiple values).</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-7">Details<a class="anchor" aria-label="anchor" href="#details-7"></a></h4>
<p>This applies the given cuts to the supplied landscape layer to produce areal groupings of the catchment. Cuts are implement using <code>terra::cut</code> with <code>include.lowest = TRUE</code>. Note that is specifying a vector of cuts values outside the limits will be set to NA.</p>
</div>


</div><p></p><hr><a id="method-dynatopGIS-combine_classes"></a><div class="section">
<h3 id="method-combine-classes-">Method <code>combine_classes()</code><a class="anchor" aria-label="anchor" href="#method-combine-classes-"></a></h3>
<p>Combine any number of classifications based on unique combinations and burns</p><div class="section">
<h4 id="usage-10">Usage<a class="anchor" aria-label="anchor" href="#usage-10"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">combine_classes</span><span class="op">(</span><span class="va">layer_name</span>, <span class="va">pairs</span>, burns <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-10">Arguments<a class="anchor" aria-label="anchor" href="#arguments-10"></a></h4>
<p></p><div class="arguments"><dl><dt><code>layer_name</code></dt>
<dd><p>name of the new layer to create</p></dd>


<dt><code>pairs</code></dt>
<dd><p>a vector of layer names to combine into new classes through unique combinations. Names should correspond to raster layers in the project directory.</p></dd>


<dt><code>burns</code></dt>
<dd><p>a vector of layer names which are to be burnt on</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-8">Details<a class="anchor" aria-label="anchor" href="#details-8"></a></h4>
<p>This applies the given cuts to the supplied landscape layers to produce areal groupings of the catchment. Burns are added directly in the order they are given. Cuts are implement using <code>terra::cut</code> with <code>include.lowest = TRUE</code>. Note that is specifying a vector of cuts values outside the limits will be set to NA.</p>
</div>


</div><p></p><hr><a id="method-dynatopGIS-create_model"></a><div class="section">
<h3 id="method-create-model-">Method <code>create_model()</code><a class="anchor" aria-label="anchor" href="#method-create-model-"></a></h3>
<p>Compute a Dynamic TOPMODEL</p><div class="section">
<h4 id="usage-11">Usage<a class="anchor" aria-label="anchor" href="#usage-11"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">create_model</span><span class="op">(</span></span>
<span>  <span class="va">layer_name</span>,</span>
<span>  <span class="va">class_layer</span>,</span>
<span>  <span class="va">dist_layer</span>,</span>
<span>  sf_opt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cnst"</span>, <span class="st">"kin"</span><span class="op">)</span>,</span>
<span>  sz_opt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp"</span>, <span class="st">"bexp"</span>, <span class="st">"cnst"</span>, <span class="st">"dexp"</span><span class="op">)</span>,</span>
<span>  dist_delta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  rain_layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rain_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>  pet_layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pet_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-11">Arguments<a class="anchor" aria-label="anchor" href="#arguments-11"></a></h4>
<p></p><div class="arguments"><dl><dt><code>layer_name</code></dt>
<dd><p>name for the new model and layers</p></dd>


<dt><code>class_layer</code></dt>
<dd><p>the layer defining the topographic classes</p></dd>


<dt><code>dist_layer</code></dt>
<dd><p>the layer defining the distances to the channel</p></dd>


<dt><code>sf_opt</code></dt>
<dd><p>Surface solution to use</p></dd>


<dt><code>sz_opt</code></dt>
<dd><p>transmissivity transmissivity profile to use</p></dd>


<dt><code>dist_delta</code></dt>
<dd><p>TODO</p></dd>


<dt><code>rain_layer</code></dt>
<dd><p>the layer defining the rainfall inputs</p></dd>


<dt><code>rain_label</code></dt>
<dd><p>Prepended to rain_layer values to give rainfall series name</p></dd>


<dt><code>pet_layer</code></dt>
<dd><p>the layer defining the pet inputs</p></dd>


<dt><code>pet_label</code></dt>
<dd><p>Prepended to pet_layer values to give pet series name</p></dd>


<dt><code>verbose</code></dt>
<dd><p>print more details of progress</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-9">Details<a class="anchor" aria-label="anchor" href="#details-9"></a></h4>
<p>The <code>class_layer</code> is used to define the HRUs. Flow between HRUs is based on the distance to a channel. For each HRU the shortest distance to a channel is computed. Flow from a HRU can only go to a HRU with a lower shortest distance to the channel. Flow from a HRU can occur from any raster cell within the HRU whose distance to the channel is within dist_delta of the shortest distance within the HRU.
Setting the sf_opt and sz_opt options ensures the model is set up with the correct parameters present.
The <code>rain_layer</code> (<code>pet_layer</code>) can contain the numeric id values of different rainfall (pet) series. If the value of <code>rain_layer</code> (<code>pet_layer</code>) is not <code>NULL</code> the weights used to compute an averaged input value for each HRU are computed, otherwise an input table for the models generated with the value "missing" used in place of the series name.</p>
</div>


</div><p></p><hr><a id="method-dynatopGIS-get_version"></a><div class="section">
<h3 id="method-get-version-">Method <code>get_version()</code><a class="anchor" aria-label="anchor" href="#method-get-version-"></a></h3>
<p>get the version number</p><div class="section">
<h4 id="usage-12">Usage<a class="anchor" aria-label="anchor" href="#usage-12"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">get_version</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="details-10">Details<a class="anchor" aria-label="anchor" href="#details-10"></a></h4>
<p>the version number indicates the version of the algorithms within the object</p>
</div>

<div class="section">
<h4 id="returns-6">Returns<a class="anchor" aria-label="anchor" href="#returns-6"></a></h4>
<p>a numeric version number</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-get_method"></a><div class="section">
<h3 id="method-get-method-">Method <code>get_method()</code><a class="anchor" aria-label="anchor" href="#method-get-method-"></a></h3>
<p>get the cuts and burns used to classify</p><div class="section">
<h4 id="usage-13">Usage<a class="anchor" aria-label="anchor" href="#usage-13"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">get_method</span><span class="op">(</span><span class="va">layer_name</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-12">Arguments<a class="anchor" aria-label="anchor" href="#arguments-12"></a></h4>
<p></p><div class="arguments"><dl><dt><code>layer_name</code></dt>
<dd><p>the name of layer whose classification method is returned</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-7">Returns<a class="anchor" aria-label="anchor" href="#returns-7"></a></h4>
<p>a list with two elements, cuts and burns</p>
</div>

</div><p></p><hr><a id="method-dynatopGIS-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-14">Usage<a class="anchor" aria-label="anchor" href="#usage-14"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-13">Arguments<a class="anchor" aria-label="anchor" href="#arguments-13"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## The vignettes contains more examples of the method calls.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## create temport directory for output</span></span></span>
<span class="r-in"><span><span class="va">demo_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"dygis"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">demo_dir</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## initialise processing</span></span></span>
<span class="r-in"><span><span class="va">ctch</span> <span class="op">&lt;-</span> <span class="va">dynatopGIS</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">demo_dir</span>,<span class="st">"test"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating new folder</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting new project at /tmp/Rtmp1UiXow/dygis1e25478b6141/test</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## add digital elevation and channel data</span></span></span>
<span class="r-in"><span><span class="va">dem_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"SwindaleDTM40m.tif"</span>, package<span class="op">=</span><span class="st">"dynatopGIS"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">dem_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">add_dem</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">channel_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"SwindaleRiverNetwork.shp"</span>,</span></span>
<span class="r-in"><span>package<span class="op">=</span><span class="st">"dynatopGIS"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sp_lines</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">channel_file</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>[vect] Z coordinates ignored</span>
<span class="r-in"><span><span class="va">property_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"identifier"</span>,endNode<span class="op">=</span><span class="st">"endNode"</span>,startNode<span class="op">=</span><span class="st">"startNode"</span>,length<span class="op">=</span><span class="st">"length"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">chn</span> <span class="op">&lt;-</span> <span class="fu"><a href="convert_channel.html">convert_channel</a></span><span class="op">(</span><span class="va">sp_lines</span>,<span class="va">property_names</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Modifying to spatial polygons using default width</span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">add_channel</span><span class="op">(</span><span class="va">chn</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## compute properties </span></span></span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">sink_fill</span><span class="op">(</span><span class="op">)</span> <span class="co">## fill sinks in the catchment</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">compute_properties</span><span class="op">(</span><span class="op">)</span> <span class="co"># like topograpihc index and contour length</span></span></span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">compute_flow_lengths</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>NAs introduced by coercion to integer range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>NAs introduced by coercion to integer range</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co">## classify and create a model</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">classify</span><span class="op">(</span><span class="st">"atb_20"</span>,<span class="st">"atb"</span>,cuts<span class="op">=</span><span class="fl">20</span><span class="op">)</span> <span class="co"># classify using the topographic index</span></span></span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">get_method</span><span class="op">(</span><span class="st">"atb_20"</span><span class="op">)</span> <span class="co">## see the details of the classification</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "classification"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $layer</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "atb"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cuts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  8.6361  9.3714 10.1066 10.8418 11.5771 12.3123 13.0476 13.7828 14.5181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10] 15.2533 15.9885 16.7238 17.4590 18.1943 18.9295 19.6647 20.4000 21.1352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] 21.8705 22.6057 23.3410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">combine_classes</span><span class="op">(</span><span class="st">"atb_20_band"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"atb_20"</span>,<span class="st">"band"</span><span class="op">)</span><span class="op">)</span> <span class="co">## combine classes</span></span></span>
<span class="r-in"><span><span class="va">ctch</span><span class="op">$</span><span class="fu">create_model</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">demo_dir</span>,<span class="st">"new_model"</span><span class="op">)</span>,<span class="st">"atb_20_band"</span>,<span class="st">"band"</span><span class="op">)</span> <span class="co">## create a model</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">demo_dir</span>,pattern<span class="op">=</span><span class="st">"new_model*"</span><span class="op">)</span> <span class="co">## look at the output files for the model</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "new_model.rds" "new_model.tif"</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co">## tidy up</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">demo_dir</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Paul Smith.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

