<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>R6 Class for processing a catchment to make a Dynamic TOPMODEL — dynatopGIS • dynatopGIS</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="R6 Class for processing a catchment to make a Dynamic TOPMODEL — dynatopGIS" />
<meta property="og:description" content="This package contains the code for setting up a dynamic TOPMODEL implimentation" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatopGIS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dynatopGIS.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Banding.html">Banding of HSUs</a>
    </li>
    <li>
      <a href="../articles/sink_filling.html">Filling sinks and gaps in the DEM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/waternumbers/dynatopGIS/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>R6 Class for processing a catchment to make a Dynamic TOPMODEL</h1>
    <small class="dont-index">Source: <a href='https://github.com/waternumbers/dynatopGIS/blob/master/R/dygis.R'><code>R/dygis.R</code></a>, <a href='https://github.com/waternumbers/dynatopGIS/blob/master/R/dynatopGIS-package.R'><code>R/dynatopGIS-package.R</code></a></small>
    <div class="hidden name"><code>dynatopGIS.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This package contains the code for setting up a dynamic TOPMODEL implimentation</p>
    </div>



    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
<h3>Public methods</h3>

<ul>
<li><p><a href='#method-new'><code>dynatopGIS$new()</code></a></p></li>
<li><p><a href='#method-add_layer'><code>dynatopGIS$add_layer()</code></a></p></li>
<li><p><a href='#method-get_layer'><code>dynatopGIS$get_layer()</code></a></p></li>
<li><p><a href='#method-plot_layer'><code>dynatopGIS$plot_layer()</code></a></p></li>
<li><p><a href='#method-add_channel'><code>dynatopGIS$add_channel()</code></a></p></li>
<li><p><a href='#method-get_channel'><code>dynatopGIS$get_channel()</code></a></p></li>
<li><p><a href='#method-sink_fill'><code>dynatopGIS$sink_fill()</code></a></p></li>
<li><p><a href='#method-compute_properties'><code>dynatopGIS$compute_properties()</code></a></p></li>
<li><p><a href='#method-classify'><code>dynatopGIS$classify()</code></a></p></li>
<li><p><a href='#method-get_class'><code>dynatopGIS$get_class()</code></a></p></li>
<li><p><a href='#method-plot_class'><code>dynatopGIS$plot_class()</code></a></p></li>
<li><p><a href='#method-create_model'><code>dynatopGIS$create_model()</code></a></p></li>
<li><p><a href='#method-get_model'><code>dynatopGIS$get_model()</code></a></p></li>
<li><p><a href='#method-plot_model'><code>dynatopGIS$plot_model()</code></a></p></li>
<li><p><a href='#method-neighbour'><code>dynatopGIS$neighbour()</code></a></p></li>
<li><p><a href='#method-get_class_method'><code>dynatopGIS$get_class_method()</code></a></p></li>
<li><p><a href='#method-get_version'><code>dynatopGIS$get_version()</code></a></p></li>
<li><p><a href='#method-clone'><code>dynatopGIS$clone()</code></a></p></li>
</ul>
<p><hr>
<a id="method-new"></a></p><h3>Method <code>new()</code></h3>
<p>Reads the DEM file, sets up the raster catchment description</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>new</span>(<span class='no'>dem</span>, <span class='kw'>fill_na</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>dem</code></dt><dd><p>a RasterLayer containing the dem</p></dd>

<dt><code>fill_na</code></dt><dd><p>should NA values in dem be filled. See details</p></dd>

</dl><p></div></p>
<h3>Details</h3>
<p>Reads in the dem using the raster package. If fill_na all NA values other then those that link to the edge of the dem are filled with Inf, so they can be identified as sinks.</p>

<h3>Returns</h3>
<p>A new `dynatopGIS` object</p>
<p><hr>
<a id="method-add_layer"></a></p><h3>Method <code>add_layer()</code></h3>
<p>Add a layer of geographical information</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>add_layer</span>(<span class='no'>raster_layer</span>, <span class='no'>layer_name</span>, <span class='kw'>check_name</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>raster_layer</code></dt><dd><p>a RasterLayer object to add</p></dd>

<dt><code>layer_name</code></dt><dd><p>name to give to the layer</p></dd>

<dt><code>check_name</code></dt><dd><p>logical indicating if name should be checked against reserved names</p></dd>

</dl><p></div></p>
<h3>Details</h3>
<p>The default is to check the name so that names reserved for computed varaibles are not overwritten. Disabling to overwrite computed layer may have unintended consequences.</p>

<h3>Returns</h3>
<p>suitable for chaining</p>
<p><hr>
<a id="method-get_layer"></a></p><h3>Method <code>get_layer()</code></h3>
<p>Get a layer of geographical information or a list of layer names</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>get_layer</span>(<span class='kw'>layer_name</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span>(<span class='fl'>0</span>))</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>layer_name</code></dt><dd><p>name of the layer give to the layer</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p>a RasterLayer of the requested information if layer_name is given else a vector of layer names</p>
<p><hr>
<a id="method-plot_layer"></a></p><h3>Method <code>plot_layer()</code></h3>
<p>Plot a layer</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>plot_layer</span>(<span class='no'>layer_name</span>, <span class='kw'>add_channel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>layer_name</code></dt><dd><p>the name of layer to plot</p></dd>

<dt><code>add_channel</code></dt><dd><p>shouel the channel be added to the plot</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p>a plot</p>
<p><hr>
<a id="method-add_channel"></a></p><h3>Method <code>add_channel()</code></h3>
<p>Import channel data from an OGR file to the `dynatopGIS` object</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>add_channel</span>(
  <span class='no'>sp_object</span>,
  <span class='kw'>property_names</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>length</span> <span class='kw'>=</span> <span class='st'>"length"</span>, <span class='kw'>startNode</span> <span class='kw'>=</span> <span class='st'>"startNode"</span>, <span class='kw'>endNode</span> <span class='kw'>=</span> <span class='st'>"endNode"</span>,
    <span class='kw'>width</span> <span class='kw'>=</span> <span class='st'>"width"</span>),
  <span class='kw'>default_width</span> <span class='kw'>=</span> <span class='fl'>2</span>
)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>sp_object</code></dt><dd><p>a spatialLinesDataFrame containing the channel information</p></dd>

<dt><code>property_names</code></dt><dd><p>named vector of columns of the spatial data frame to use for channel properties</p></dd>

<dt><code>default_width</code></dt><dd><p>default width of a channel if not specified in property_names. Defaults to 2 metres.</p></dd>

</dl><p></div></p>
<h3>Details</h3>
<p>Takes the input file and covnerts it to polygons with properties length,width,startNode,endNode. The variable names in the sp_object data frame which corresponding to these properties can be specified in the <code>property_names</code> vector.
The function opulates the channel_id &amp; channel_area layers and alters the land_area layer to correspond.</p>

<h3>Returns</h3>
<p>suitable for chaining</p>
<p><hr>
<a id="method-get_channel"></a></p><h3>Method <code>get_channel()</code></h3>
<p>Get the channel description</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>get_channel</span>()</pre><p></div></p>

<h3>Returns</h3>
<p>an SpatialPolygonDataFrame containing the channels</p>
<p><hr>
<a id="method-sink_fill"></a></p><h3>Method <code>sink_fill()</code></h3>
<p>The sink filling algorithm of Planchona and Darboux 2001</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>sink_fill</span>(
  <span class='kw'>min_grad</span> <span class='kw'>=</span> <span class='fl'>1e-04</span>,
  <span class='kw'>max_it</span> <span class='kw'>=</span> <span class='fl'>1e+06</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>hot_start</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>min_grad</code></dt><dd><p>Minimum gradient between cell centres</p></dd>

<dt><code>max_it</code></dt><dd><p>maximum number of replacement cycles</p></dd>

<dt><code>verbose</code></dt><dd><p>print out additional diagnostic information</p></dd>

<dt><code>hot_start</code></dt><dd><p>start from filled_dem if it exists</p></dd>

</dl><p></div></p>
<h3>Details</h3>
<p>The algorithm implimented in Planchona and Darboux, "A fast, simple and versatile algorithm to fill the depressions in digital elevation models" Catena 46 (2001). A pdf can be found at https://horizon.documentation.ird.fr/exl-doc/pleins_textes/pleins_textes_7/sous_copyright/010031925.pdf.</p>

<p><hr>
<a id="method-compute_properties"></a></p><h3>Method <code>compute_properties()</code></h3>
<p>Computes statistics e.g. log(a/tanb) for raster cells</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>compute_properties</span>(<span class='kw'>missing_grad</span> <span class='kw'>=</span> <span class='fl'>1e-04</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>missing_grad</code></dt><dd><p>gradient that can be assigned to a pixel if it can't be computed</p></dd>

<dt><code>verbose</code></dt><dd><p>print out additional diagnostic information</p></dd>

</dl><p></div></p>
<h3>Details</h3>
<p>The algorithm works in two passes. The first computes the number of upstream pixels and values that do not depend on ordering. The second sequences downslope to compute values. Missing gradient is only used for pixels which are partially channel but have no upslope neighbours.</p>

<p><hr>
<a id="method-classify"></a></p><h3>Method <code>classify()</code></h3>
<p>Split a catchment into a set hydrological response units (HRUs) according to any number of landscape layer cuts or burns</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>classify</span>(<span class='no'>cuts</span>, <span class='kw'>burns</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>cuts</code></dt><dd><p>A named list of cuts of make to form the HRU. Names should correspond to raster layers in the project directory. Values should be numeric and define either the number of bands (single value) or breaks between band (multiple values)</p></dd>

<dt><code>burns</code></dt><dd><p>a vector of layer names which are to be used as burns</p></dd>

</dl><p></div></p>
<h3>Details</h3>
<p>This applies the given cuts to the supplied landscape layers to produce areal groupings of the catchment. Burns are added directly in the order they are given. Changing teh classification removes the current model ensuring the two are always syncronised.</p>

<p><hr>
<a id="method-get_class"></a></p><h3>Method <code>get_class()</code></h3>
<p>Get a classification layer of geographical information or a list of layer names</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>get_class</span>(<span class='kw'>layer_name</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span>(<span class='fl'>0</span>))</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>layer_name</code></dt><dd><p>name of the layer give to the layer</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p>a RasterLayer of the requested information if layer_name is given else a vector of layer names</p>
<p><hr>
<a id="method-plot_class"></a></p><h3>Method <code>plot_class()</code></h3>
<p>Plot a classification layer</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>plot_class</span>(<span class='kw'>layer_name</span> <span class='kw'>=</span> <span class='st'>"final"</span>, <span class='kw'>add_channel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>layer_name</code></dt><dd><p>the name of layer to plot</p></dd>

<dt><code>add_channel</code></dt><dd><p>shouel the channel be added to the plot</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p>a plot</p>
<p><hr>
<a id="method-create_model"></a></p><h3>Method <code>create_model()</code></h3>
<p>Compute a Dynamic TOPMODEL</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>create_model</span>(<span class='kw'>band</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>band</code></dt><dd><p>How to cut the bands into the model, interpreted as for a cut in the classify method</p></dd>

<dt><code>verbose</code></dt><dd><p>print out additional diagnostic information</p></dd>

</dl><p></div></p>
<p><hr>
<a id="method-get_model"></a></p><h3>Method <code>get_model()</code></h3>
<p>Get the model is a form suitable for dynatop</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>get_model</span>()</pre><p></div></p>

<h3>Returns</h3>
<p>a Dynamic TOPMODE description suitable for the <code>dyantop</code> package</p>
<p><hr>
<a id="method-plot_model"></a></p><h3>Method <code>plot_model()</code></h3>
<p>Plot the spatial properties of a model</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>plot_model</span>(<span class='kw'>add_channel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>add_channel</code></dt><dd><p>should the channel be added to the plot</p></dd>

</dl><p></div></p>
<p><hr>
<a id="method-neighbour"></a></p><h3>Method <code>neighbour()</code></h3>
<p>Return the index of neighbouring cells</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>neighbour</span>(<span class='no'>x</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>x</code></dt><dd><p>index of cells for which to find neighbours</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p>a list of indexes of neighbours</p>
<p><hr>
<a id="method-get_class_method"></a></p><h3>Method <code>get_class_method()</code></h3>
<p>get the cuts and burns used to classify</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>get_class_method</span>()</pre><p></div></p>

<h3>Returns</h3>
<p>a list with two elements, cuts and burns</p>
<p><hr>
<a id="method-get_version"></a></p><h3>Method <code>get_version()</code></h3>
<p>get the version number</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>get_version</span>()</pre><p></div></p>

<h3>Details</h3>
<p>teh version number indicates the version of the algorithms within the object</p>

<h3>Returns</h3>
<p>a numeric version number</p>
<p><hr>
<a id="method-clone"></a></p><h3>Method <code>clone()</code></h3>
<p>The objects of this class are cloneable with this method.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>dynatopGIS</span>$<span class='fu'>clone</span>(<span class='kw'>deep</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p></dd>

</dl><p></div></p>



  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Paul Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


